#!groovy

properties([disableConcurrentBuilds()])

node('Backend'){
    sh 'echo $ref'
    if ( ref == 'refs/heads/backend' )  {
        stage('Checkout')  {
            git branch: 'backend', credentialsId: 'ssh-key-main', url: 'git@github.com:Ihor-Porokhnia/WebApp.git'
        }
        stage('Build')  {
            sh 'mvn versions:set  -DnewVersion=2.5.0-SNAPSHOT' 
            sh 'mvn clean install'
        }
        stage('Deploy')  {
           
           sh 'echo $BUILD_NUMBER'
           sh 'sudo cp target/Backend* /opt/tomcat/latest/webapps/Backend.war'
           sh 'sudo systemctl restart tomcat'
           sh 'sudo systemctl restart nginx'
        }
    } else {
              sh 'echo notback'
    }
}


node('Frontend'){
    if ( ref == 'refs/heads/frontend')  {
              sh 'echo $ref'
    } else {
              sh 'echo notfront'
    }
}
