#!groovy

node('master') {
 properties([
  pipelineTriggers([
   [$class: 'GenericTrigger',
    genericVariables: [
     [ key: 'actorname', value: '$.message.from.username' ],
     [ key: 'message', value: '$.message.text' ],

    ],
    token: 'tp',
    printContributedVariables: true,
    printPostContent: true,

   ]
  ])
 ])
 script {
        ping_prefix = "/ping"
        pipe_prefix = "/pipe"
        par1 = message.split(" ")[1]
        par2 = message.split(" ")[2]
    }

if (message.startsWith(pipe_prefix)) {

  try {
    telegramSend(message: 'Trying run job ' + par1 + ' ' , chatId: -393518449)
    build job: par1, parameters: [string(name: 'OPERATION', value: par2)]
    telegramSend(message: 'Job ' + par1 + ' ended' , chatId: -393518449)
      }
      catch (exc) {
        telegramSend(message: 'Job ' + par1 + ' not found' , chatId: -393518449)
      }
    }
///////

///////
}
