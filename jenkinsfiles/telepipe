#!groovy

node('master') {
 properties([
  pipelineTriggers([
   [$class: 'GenericTrigger',
    genericVariables: [
     [ key: 'actorname', value: '$.message.from.username' ],
     [ key: 'message', value: '$.message.text' ],

    ],
    token: 'tp',
    printContributedVariables: true,
    printPostContent: true,

   ]
  ])
 ])
 script {
        pipe_prefix = "/pipe"

        word = message.split(" ")[1]

    }

if (message.startsWith(pipe_prefix)) {

  try {
    telegramSend(message: 'Trying run job ' + word + ' ' , chatId: -393518449)
    build(job: word)
    telegramSend(message: 'Job ' + word + ' ended' , chatId: -393518449)
  }
    catch (exc) {
  telegramSend(message: 'Job ' + word + ' not found' , chatId: -393518449)
}
 }

}
